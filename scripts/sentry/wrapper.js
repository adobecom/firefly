(()=>{let e=["bg-bg","cs-cz","da-dk","de-de","el-gr","en-ae","en-gb","en-hr","en-il","en-ke","en-lk","en-mo","en-mu","en-ng","en-tt","en-us","en-vn","en-xm","es-bo","es-do","es-es","es-la","es-mx","es-na","es-pa","es-py","es-sv","es-uy","et-ee","fi-fi","fil-ph","fr-ca","fr-fr","fr-ma","fr-xm","hr-hr","hu-hu","id-id","it-it","ja-jp","ko-kr","lt-lt","lv-lv","nb-no","nl-nl","ms-my","pl-pl","pt-br","ro-ro","ru-ru","sk-sk","sl-si","sr-rs","sr-sp","sv-se","th-th","tr-tr","uk-ua","vi-vn","zh-cn","zh-hans","zh-hant","zh-mo","zh-tw"],t=["en-us","es-es","fr-fr","sr-rs","zh-cn"];function s(s){let n=s.toLowerCase().replace("_","-"),[r]=n.split("-");if(e.includes(n))return n;let a=t.find(e=>e.startsWith(r))||e.find(e=>e.startsWith(r));return a||"en-us"}let n={LOCAL:"local",STAGE:"stage",PROD:"prod"};function r(e,t=!1){return t?n.STAGE:e.includes("localhost.corp.adobe.com")?n.LOCAL:e.includes("auth-light-sample.identity-stage.adobe.com")?n.STAGE:n.PROD}class a extends Error{name="ElmError"}let i={[n.LOCAL]:"https://localhost.corp.adobe.com:8081",[n.STAGE]:"https://auth-light.identity-stage.adobe.com/sentry",[n.PROD]:"https://auth-light.identity.adobe.com/sentry"},o={[n.LOCAL]:"https://localhost.corp.adobe.com:25000",[n.STAGE]:"https://auth-light.identity-stage.adobe.com",[n.PROD]:"https://auth-light.identity.adobe.com"},l={[n.LOCAL]:"https://localhost.corp.adobe.com:4200/signin",[n.STAGE]:"https://auth-stg1.services.adobe.com/signin/v1/audit",[n.PROD]:"https://auth.services.adobe.com/signin/v1/audit"},h=e=>i[e],c=e=>o[e],d=e=>l[e],u=new Map;async function p(e,t=!1){if(u.has(e))return u.get(e);{let s=function(e,t=!1){return new Promise((s,n)=>{let a=r(window.location.href,t),i=h(a),o=document.createElement("script");o.src=`${i}/${e.script}`,document.head.appendChild(o),o.onload=s,o.onerror=n})}(e,t);return u.set(e,s),s}}function m(e){try{return JSON.parse(e)}catch(t){return e}}function g(e,t,s){if(e&&Object.prototype.hasOwnProperty.call(e,t)&&"object"==typeof e[t]&&"function"==typeof e[t].subscribe){let n=e[t];n.subscribe(e=>s(m(e)))}else console.error("No port: "+t)}var f={variants:[["edu-express","EduExpress"],["sandbox","Sandbox"]],locales:["bg-bg","cs-cz","da-dk","de-de","el-gr","en-ae","en-gb","en-hr","en-il","en-ke","en-lk","en-mo","en-mu","en-ng","en-tt","en-us","en-vn","en-xm","es-bo","es-do","es-es","es-la","es-mx","es-na","es-pa","es-py","es-sv","es-uy","et-ee","fi-fi","fil-ph","fr-ca","fr-fr","fr-ma","fr-xm","hr-hr","hu-hu","id-id","it-it","ja-jp","ko-kr","lt-lt","lv-lv","ms-my","nb-no","nl-nl","pl-pl","pt-br","ro-ro","ru-ru","sk-sk","sl-si","sr-rs","sr-sp","sv-se","th-th","tr-tr","uk-ua","vi-vn","zh-cn","zh-hans","zh-hant","zh-mo","zh-tw"],example:"__NAME__.__LOCALE__.fc652747.js"};let w=new Map(f.variants),y=new Map;function v(e,t){let n=w.get(e),r=s(t);if(!n)throw Error("Invalid variant.");f.locales.includes(r)||(console.warn(`Locale ${r} not found for variant ${e}, defaulting to "en-us".`),r="en-us");let a=f.example.replace("__NAME__",e).replace("__LOCALE__",r);return y.has(a)||y.set(a,{script:a,name:n,translations:f.translations}),y.get(a)}let b=["relay","client_id","locale","redirect_uri","scope","sl","response_type"];document.querySelectorAll('meta[name="susi-sentry-preload"]').forEach(e=>{let t="true"===e.dataset.stage,s=e.dataset.locale,n=v(e.content,s);n&&p(n,t)});class _ extends HTMLElement{renderRoot;isConstructed=!1;_authparams=null;_config=null;_variant=null;_stage=!1;_popup=!1;module;_variantPromise=null;logMessage;requiredParams=["authParams","config","variant"];constructor(){super();try{this.renderRoot=this.attachShadow({mode:"open"}),this.popup=this.getAttribute("popup"),this.stage=this.getAttribute("stage"),this.variant=this.getAttribute("variant")}catch(e){console.warn("SUSI Light - Missing parameters on init.",e)}}connectedCallback(){this.isConstructed=!0,this.attemptRenderModule()}set variant(e){e&&(this._variant=e),this.attemptRenderModule()}get variant(){return this._variant??""}get locale(){return this.authParams.locale}get popup(){return this._popup}set popup(e){this._popup="string"==typeof e?"true"===e:!!e,this.attemptRenderModule()}get stage(){return this._stage}set stage(e){this._stage="string"==typeof e?"true"===e:!!e,this.attemptRenderModule()}set authParams(e){this._authparams=e,this.attemptRenderModule()}get authParams(){return this._authparams}set config(e){this._config=e,this.attemptRenderModule()}get config(){return this._config}get systemParams(){return{mode:this.popup?"popup":"redirect"}}get appState(){if(!this.authParams)return{};let e=this.authParams.relay??function(){let e=new Uint8Array(16);crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let t=Array.from(e,e=>e.toString(16).padStart(2,"0")),s=[...t.slice(0,4),"-",...t.slice(4,6),"-",...t.slice(6,8),"-",...t.slice(8,10),"-",...t.slice(10)].join("");return s}(),t={...this.authParams,sl:window.origin,relay:e},s=e=>b.includes(e),n=Object.fromEntries(Object.entries(t).filter(([e,t])=>t&&s(e))),r=Object.entries(t).map(([e,t])=>[e,t.toString()]);return{queryState:n,authParams:r,systemParams:this.systemParams,config:this.config}}async initializeApplication(e){var t,i;let o=r(window.location.href,this.stage),l=(t=this.module,i=s(this.locale),o===n.LOCAL?t.translations:window.ElmTranslations[t.name][i]),h=window.Elm[this.module.name].Main.init({node:e,flags:{...this.appState,translations:l}});return h.ports&&(g(h.ports,"onOpenPopup",e=>{!function({url:e,title:t,w:s,h:n}){let r=void 0!==window.screenLeft?window.screenLeft:window.screenX,a=void 0!==window.screenTop?window.screenTop:window.screenY,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,l=(i-parseInt(s))/2+r,h=(o-parseInt(n))/2+a;window.open(e,t,`
    menubar=0,
    resizable=0,
    scrollbars=no,
    width=${s}, 
    height=${n}, 
    top=${h}, 
    left=${l}
    `)}({url:e,title:"SUSI Light Login",w:"459",h:"768"})}),g(h.ports,"onSentryEvent",e=>{this.dispatchEvent(new CustomEvent(e.name,{detail:e.data}))}),g(h.ports,"onLogMessage",e=>{if("app-error"===e.name){let t=new a(e.message);this.dispatchError(t)}else this.logMessage(e)})),h}static observedAttributes=["authParams","config","stage","variant","stage","popup"];createShadow(){return this.attachShadow({mode:"closed"})}renderModule(){this.module=v(this.variant,this.locale),this._variantPromise=p(this.module,this.stage),this.isConstructed&&this.render()}attemptRenderModule(){let e=this.requiredParams.filter(e=>!this[e]);if(e.length>0){console.warn(`All required parameters not yet supplied: ${e.join(", ")}`);return}let{queryState:t}=this.appState,s=r(window.location.href,this.stage);this.logMessage=function(e,t,s,r){let a=function(e){switch(e){case n.LOCAL:return"susi-light-local";case n.STAGE:return"susi-light-stage";case n.PROD:return"susi-light-prod";default:return"susi-light-unknown"}}(e);return function(n){fetch(d(e),{method:"POST",headers:{"Content-Type":"application/json","X-IMS-CLIENTID":t,"X-DEBUG-ID":s},body:JSON.stringify({...n,variant:r,envName:a,clientId:t})})}}(s,t.client_id,t.relay,this.variant),this.renderModule()}async render(){let e=r(window.location.href,this.stage),t=c(e),s=new Promise((e,s)=>{window.addEventListener("message",function s(n){t.includes(n.origin)&&(e(n.ports[0]),window.removeEventListener("message",s))})}),{client_id:n,relay:a}=this.appState.queryState,i=this.authParams.st_valid_origin;if(this.shadowRoot)this.shadowRoot.innerHTML=`
        <style>
          :host {
            display: block;
          }

          :host * {
            box-sizing: border-box;
          }

          :host,
          #sentry-container,
          #sentry-container iframe {
            width: 100%;
            height: 100%;
            background: transparent;
            color-scheme: normal;
            border: 0;
          }

          #sentry-iframe {
            position: fixed;
            top: -10000px;
            left: -10000px;
          }
        </style>
        <section id="sentry-container">
          <section id="sentry"></sentry>
        </section>
        <iframe
          aria-hidden="true"
          id="sentry-iframe"
          height="1px" 
          width="1px" 
          src="${function(){let e=new URL("/sentry/iframe/index.html",t);return e.searchParams.append("client_id",n),e.searchParams.append("relay",a),i&&e.searchParams.append("st_valid_origin","true"),e.searchParams.append("asserted_origin",window.location.origin),e.toString()}()}" />
    `;else throw Error("shadowRoot not available");try{let[e]=await Promise.all([s,this._variantPromise]),t=await this.initializeApplication(this.renderRoot.getElementById("sentry")),n=this.logMessage;e.onmessage=function(e){try{let s=m(e.data),n=m(s.data);t.ports&&"query-state"===s.name?t.ports.onPopupMessage.send(n):console.log(e)}catch(e){n({name:"app-critical",message:{error:{message:e.toString()}}})}}}catch(e){this.dispatchError(e)}}dispatchError(e){let t={name:"unrecoverable",error:{name:e.name,message:e.message,stack:e.stack}};this.dispatchEvent(new CustomEvent("on-error",{detail:t})),this.logMessage({name:"app-error",message:t})}}window.customElements.define("susi-sentry-light",_)})();
//# sourceMappingURL=wrapper.js.map
